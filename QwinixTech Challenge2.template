{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Qwinix Tech Challenge",
  "Parameters": {
    "InstanceType": {
      "Description": "Choose your instance type",
      "Type": "String",
      "Default": "t1.micro",
      "AllowedValues": [
        "t1.micro",
        "t2.micro",
        "m1.small",
        "m1.medium",
        "m1.large",
        "m3.medium",
        "m3.large",
        "m3.xlarge",
        "m3.2xlarge",
        "c1.medium",
        "r3.large"
      ],
      "ConstraintDescription": "Must be a valid EC2 instance type"
    }
  },
  "Mappings": {
    "AWSInstanceType2Arch": {
      "t1.micro": {
        "Arch": "PV64"
      },
      "t2.micro": {
        "Arch": "HVM64"
      },
      "m1.small": {
        "Arch": "PV64"
      },
      "m1.medium": {
        "Arch": "PV64"
      },
      "m1.large": {
        "Arch": "PV64"
      },
      "m3.medium": {
        "Arch": "HVM64"
      },
      "m3.large": {
        "Arch": "HVM64"
      },
      "m3.xlarge": {
        "Arch": "HVM64"
      },
      "m3.2xlarge": {
        "Arch": "HVM64"
      },
      "c1.medium": {
        "Arch": "PV64"
      },
      "r3.large": {
        "Arch": "HVM64"
      }
    },
    "AWSRegionArch2AMI": {
      "us-east-1": {
        "PV64": "ami-50842d38",
        "HVM64": "ami-08842d60",
        "HVMG2": "ami-3a329952"
      },
      "us-west-2": {
        "PV64": "ami-af86c69f",
        "HVM64": "ami-8786c6b7",
        "HVMG2": "ami-47296a77"
      },
      "us-west-1": {
        "PV64": "ami-c7a8a182",
        "HVM64": "ami-cfa8a18a",
        "HVMG2": "ami-331b1376"
      },
      "eu-west-1": {
        "PV64": "ami-aa8f28dd",
        "HVM64": "ami-748e2903",
        "HVMG2": "ami-00913777"
      },
      "ap-southeast-1": {
        "PV64": "ami-20e1c572",
        "HVM64": "ami-d6e1c584",
        "HVMG2": "ami-fabe9aa8"
      },
      "ap-northeast-1": {
        "PV64": "ami-21072820",
        "HVM64": "ami-35072834",
        "HVMG2": "ami-5dd1ff5c"
      },
      "ap-southeast-2": {
        "PV64": "ami-8b4724b1",
        "HVM64": "ami-fd4724c7",
        "HVMG2": "ami-e98ae9d3"
      },
      "sa-east-1": {
        "PV64": "ami-9d6cc680",
        "HVM64": "ami-956cc688",
        "HVMG2": "NOT_SUPPORTED"
      },
      "cn-north-1": {
        "PV64": "ami-a857c591",
        "HVM64": "ami-ac57c595",
        "HVMG2": "NOT_SUPPORTED"
      },
      "eu-central-1": {
        "PV64": "ami-a03503bd",
        "HVM64": "ami-b43503a9",
        "HVMG2": "ami-b03503ad"
      }
    }
  },
  "Resources": {
    "WebServerSecurityGroup": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Enable HTTP access via port 8080",
        "SecurityGroupIngress": [
          {
            "IpProtocol": "tcp",
            "FromPort": "8080",
            "ToPort": "8080",
            "CidrIp": "0.0.0.0/0"
          },
          {
            "IpProtocol": "tcp",
            "FromPort": "22",
            "ToPort": "22"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "d2e00f22-aadc-4fab-ac21-45f5730a1f77"
        }
      }
    },
    "aprivatesubnet": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {},
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "534bcf3e-9d65-454f-9738-1867135f423a"
        }
      }
    },
    "ElasticLoadBalancer": {
      "Type": "AWS::ElasticLoadBalancing::LoadBalancer",
      "Properties": {
        "Instances": [
          {
            "Ref": "josephtest"
          },
          {
            "Ref": "josephtest3"
          },
          {
            "Ref": "josephtest2"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "5cc7cd81-d718-43c7-b1e5-66966a70a88a"
        }
      }
    },
    "josephtest3": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "SecurityGroupIds": [
          {
            "Ref": "WebServerSecurityGroup"
          }
        ],
        "SubnetId": {
          "Ref": "aprivatesubnet"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "5e4f9466-64c2-4dae-98aa-6f839c7b17f2"
        }
      }
    },
    "josephtest2": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "SecurityGroupIds": [
          {
            "Ref": "WebServerSecurityGroup"
          }
        ],
        "SubnetId": {
          "Ref": "aprivatesubnet"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "7f149386-c97f-4229-bbfa-dcf392951cea"
        }
      }
    },
    "josephtest": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "SecurityGroupIds": [
          {
            "Ref": "WebServerSecurityGroup"
          }
        ],
        "SubnetId": {
          "Ref": "aprivatesubnet"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "7db7034a-c7d9-4779-888f-c90bda1cc05d"
        }
      }
    },
    "ASASG5AZE9": {
      "Type": "AWS::AutoScaling::AutoScalingGroup",
      "Properties": {
        "VPCZoneIdentifier": [
          {
            "Ref": "aprivatesubnet"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "061fe939-6a7b-4a4e-9852-9d499d17bcea"
        }
      }
    },
    "ASSP13GXS": {
      "Type": "AWS::AutoScaling::ScalingPolicy",
      "Properties": {
        "AutoScalingGroupName": {
          "Ref": "ASASG5AZE9"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "4bfec67f-7183-497c-b9df-09515b9110da"
        }
      }
    }
  },
  "Outputs": {
    "WebsiteURL": {
      "Description": "URL for newly created stack",
      "Value": {
        "Fn::Join": [
          "",
          [
            "http://",
            {
              "Fn::GetAtt": [
                "josephtest",
                "PublicDnsName"
              ]
            }
          ]
        ]
      }
    }
  },
  "Metadata": {
    "AWS::CloudFormation::Designer": {
      "d2e00f22-aadc-4fab-ac21-45f5730a1f77": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -380,
          "y": -80
        },
        "z": 1,
        "embeds": []
      },
      "ce9c849e-0ada-40a3-83d5-febde8fddfaf": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 170,
          "y": 50
        },
        "z": 1,
        "embeds": [],
        "ismemberof": [
          "d2e00f22-aadc-4fab-ac21-45f5730a1f77"
        ]
      },
      "aed382cf-8610-4e30-8e1d-6cc419c33f92": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 70,
          "y": 50
        },
        "z": 1,
        "embeds": [],
        "ismemberof": [
          "d2e00f22-aadc-4fab-ac21-45f5730a1f77"
        ]
      },
      "7db7034a-c7d9-4779-888f-c90bda1cc05d": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -230,
          "y": 50
        },
        "z": 1,
        "parent": "534bcf3e-9d65-454f-9738-1867135f423a",
        "embeds": [],
        "ismemberof": [
          "d2e00f22-aadc-4fab-ac21-45f5730a1f77"
        ]
      },
      "7f149386-c97f-4229-bbfa-dcf392951cea": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -540,
          "y": 50
        },
        "z": 1,
        "parent": "534bcf3e-9d65-454f-9738-1867135f423a",
        "embeds": [],
        "ismemberof": [
          "d2e00f22-aadc-4fab-ac21-45f5730a1f77"
        ]
      },
      "e07aa75e-c147-4611-87e0-1706120e123b": {
        "source": {
          "id": "7f149386-c97f-4229-bbfa-dcf392951cea"
        },
        "target": {
          "id": "d2e00f22-aadc-4fab-ac21-45f5730a1f77"
        },
        "z": 2
      },
      "5e4f9466-64c2-4dae-98aa-6f839c7b17f2": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -380,
          "y": 50
        },
        "z": 1,
        "parent": "534bcf3e-9d65-454f-9738-1867135f423a",
        "embeds": [],
        "ismemberof": [
          "d2e00f22-aadc-4fab-ac21-45f5730a1f77"
        ]
      },
      "534bcf3e-9d65-454f-9738-1867135f423a": {
        "size": {
          "width": 520,
          "height": 150
        },
        "position": {
          "x": -610,
          "y": 0
        },
        "z": 0,
        "embeds": [
          "7db7034a-c7d9-4779-888f-c90bda1cc05d",
          "7f149386-c97f-4229-bbfa-dcf392951cea",
          "5e4f9466-64c2-4dae-98aa-6f839c7b17f2"
        ]
      },
      "5cc7cd81-d718-43c7-b1e5-66966a70a88a": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -380,
          "y": 170
        },
        "z": 0,
        "embeds": [],
        "isconnectedto": [
          "7db7034a-c7d9-4779-888f-c90bda1cc05d",
          "5e4f9466-64c2-4dae-98aa-6f839c7b17f2",
          "7f149386-c97f-4229-bbfa-dcf392951cea"
        ]
      },
      "af685ed1-32b9-4257-9616-ee436dd6baf1": {
        "source": {
          "id": "5cc7cd81-d718-43c7-b1e5-66966a70a88a"
        },
        "target": {
          "id": "7db7034a-c7d9-4779-888f-c90bda1cc05d"
        },
        "z": 2
      },
      "85d1e86c-6ab1-409d-ba8e-d8e68dc1cef9": {
        "source": {
          "id": "5cc7cd81-d718-43c7-b1e5-66966a70a88a"
        },
        "target": {
          "id": "5e4f9466-64c2-4dae-98aa-6f839c7b17f2"
        },
        "z": 3
      },
      "a67ae6a4-da59-4778-91d5-538c9abfd58d": {
        "source": {
          "id": "5cc7cd81-d718-43c7-b1e5-66966a70a88a"
        },
        "target": {
          "id": "7f149386-c97f-4229-bbfa-dcf392951cea"
        },
        "z": 4
      },
      "061fe939-6a7b-4a4e-9852-9d499d17bcea": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -710,
          "y": 40
        },
        "z": 0,
        "isconnectedto": [
          "534bcf3e-9d65-454f-9738-1867135f423a"
        ]
      },
      "d07c2d83-5016-4a45-bb6d-e6493e75ff43": {
        "source": {
          "id": "061fe939-6a7b-4a4e-9852-9d499d17bcea"
        },
        "target": {
          "id": "534bcf3e-9d65-454f-9738-1867135f423a"
        },
        "z": 2
      },
      "dd822cc0-40f4-44e8-b461-1955bd1d55c7": {
        "source": {
          "id": "061fe939-6a7b-4a4e-9852-9d499d17bcea",
          "selector": "g:nth-child(1) g:nth-child(4) g:nth-child(2) circle:nth-child(1)     ",
          "port": "AWS::RefLink-AWS::EC2::Subnet-VPCZoneIdentifier"
        },
        "target": {
          "id": "534bcf3e-9d65-454f-9738-1867135f423a"
        },
        "z": 4
      },
      "4bfec67f-7183-497c-b9df-09515b9110da": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": -710,
          "y": -40
        },
        "z": 0,
        "isassociatedwith": [
          "061fe939-6a7b-4a4e-9852-9d499d17bcea"
        ]
      },
      "9ef4e6b2-7c05-4be7-a167-a507d147684b": {
        "source": {
          "id": "4bfec67f-7183-497c-b9df-09515b9110da"
        },
        "target": {
          "id": "061fe939-6a7b-4a4e-9852-9d499d17bcea"
        },
        "z": 3
      }
    }
  }
}